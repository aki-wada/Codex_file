# 要件定義書（医療統計アシストアプリ）

## 1. 目的・スコープ
- 臨床・疫学データの記述統計、可視化、簡易検定、効果量算出をノーコード/ローコードで支援する。
- 前処理（欠測対応・外れ値確認）からレポート生成まで一貫した再現可能な出力を提供する。
- 初期スコープ: CSV/TSVインポート、前処理、記述統計、可視化、基本検定、効果量、HTMLレポート、Streamlit UI。

## 2. 利用者ロール
- 研究者/解析者: データを投入し、結果を確認・出力する。
- レビュアー: レポートと設定メタ情報を参照する。

## 3. 機能要件（現状+拡張候補）
- データ入出力
  - CSV/TSV読み込み（区切り/エンコーディング選択、サンプルプレビュー）
  - 前処理後データの保存（cleaned.csv）
- 前処理
  - 欠測行ドロップ（非欠測割合しきい値）
  - 欠測補完: 数値（なし/平均/中央値）、カテゴリ（なし/最頻値）
  - 外れ値検出: IQR、サマリー/サンプル行出力
- 記述統計・可視化
  - 数値/カテゴリサマリー、欠測サマリー
  - 数値プロット（ヒスト＋箱ひげ、列選択・上限指定）
- 群間比較
  - 効果量: multi-armペアワイズ（Cohen’s d / OR）
  - 検定: ANOVA/Tukey（数値）、Welch t（2群）、カイ二乗（カテゴリ）
- レポート
  - HTMLレポート（プロット埋め込み、タブ式外れ値、簡易サマリー、メタ情報: 入力ファイル・生成日時・設定）
- UI
  - Streamlit（設定/解析の切替、進行状況バッジ、設定保持、ダウンロード）
  - モックアップ風フロント（リンク集）
- 拡張候補
  - 検定・効果量の解釈コメント追加
  - 追加検定（Mann–Whitney U、Kruskal–Wallis、Fisher）
  - サバイバル（KM、ログランク、簡易Cox）
  - 生成物メタの拡充（バージョン、設定差分表示）

## 4. 非機能要件
- 再現性: 入力・設定・出力をフォルダ単位で保存、環境は`requirements.txt`＋venv。
- パフォーマンス: 10–50万行程度で基本集計/可視化を実用時間内（数十秒以内）を目安。
- 可搬性: ローカル実行（Python 3.12、Streamlit）、外部DB非依存。
- 品質: 基本的なエラーハンドリング（読み込み失敗、型不一致）、ロギング。

## 5. データ要件
- 入力: CSV/TSV。数値/カテゴリ混在を想定。
- サンプルデータ: 完全/欠測/多群/2群/生存解析ダミーを同梱。

## 6. UX要件
- モックアップ準拠のダークテーマ。設定と解析を明確に分離。
- 結果へのショートパス: 解析結果のレポート/ダウンロードを明示。
- 進行状況の可視化（読み込み→前処理→記述/可視化→統計）。

## 7. 画面／機能フロー（概念図）
```mermaid
flowchart LR
    A[設定ビュー\n(区切り/文字コード\n欠測処理/プレビュー)] -->|保存| B[解析ビュー]
    B --> C[データ読込]
    C --> D[前処理\n(ドロップ/補完)]
    D --> E[記述統計・可視化\n欠測/外れ値]
    E --> F[群間比較\n効果量/検定]
    F --> G[レポート生成\nHTML/CSV/PNG]
```

## 8. 開発プロセスの段階（現在位置）
- 実装済み: 入力～前処理～記述統計～可視化～基本検定/効果量～レポート～UIリンク集～メタ情報表示。
- 次の候補: 解釈コメント、追加検定/サバイバル、UIタブ整理、メタ情報拡充（バージョン表示等）。

## 9. 既存成果物
- 仕様案: `work/spec.md`
- 操作マニュアル: `work/manual.md`
- 開発ログ: `work/dev_log.md`
- 引き継ぎ: `work/handover.md`

## 10. バージョン
- 現在: `0.1.0 (2025-11-24)`
